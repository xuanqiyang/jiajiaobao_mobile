!function(a){a.fn.mdater=function(e){var t={maxDate:null,minDate:new Date(1970,0,1)},i=a.extend(t,e),n=this,s={getDaysInMonth:function(a,e){return new Date(a,e+1,0).getDate()},getWeekInMonth:function(a,e){return new Date(a,e,1).getDay()},getMonth:function(a){return["一","二","三","四","五","六","七","八","九","十","十一","十二"][a]},getLastDayInMonth:function(a,e){return new Date(a,e,this.getDaysInMonth(a,e))}};a.fn.delegates=function(e){el=a(this[0]);for(var t in e){var i=e[t];if("function"==typeof i){var n={};n.click=i,i=n}for(var s in i)el.delegate(t,s,i[s])}return this},{value:{year:"",month:"",date:""},lastCheckedDate:"",init:function(){this.initListeners()},renderHTML:function(){var e=a('<div class="md_mask"></div><div class="md_panel"><div class="md_head"><div class="md_selectarea"><a class="md_prev change_year" href="javascript:void(0);"><img style="vertical-align:middle;height:14px;" src="../images/mdate_left.png"></a><a class="md_headtext yeartag" href="javascript:void(0);"></a><a class="md_next change_year" href="javascript:void(0);"><img style="vertical-align:middle;height:14px;" src="../images/mdate_right.png"></a></div><div class="md_selectarea"><a class="md_prev change_month" href="javascript:void(0);"><img style="vertical-align:middle;height:14px;" src="../images/mdate_left.png"></a><a class="md_headtext monthtag" href="javascript:void(0);">月</a> <a class="md_next change_month" href="javascript:void(0);"><img style="vertical-align:middle;height:14px;" src="../images/mdate_right.png"></a></div></div><div class="md_body"><ul class="md_weekarea"><li>日</li><li>一</li><li>二</li><li>三</li><li>四</li><li>五</li><li>六</li></ul><ul class="md_datearea in"></ul></div><div class="md_foot"><a href="javascript:void(0);" class="md_ok">确定</a> <a href="javascript:void(0);" class="md_cancel">取消</a></div></div>');return 0==a(".md_mask").length&&a(document.body).append(e),e},_showPanel:function(e){this.refreshView(),a(".md_panel, .md_mask").addClass("show")},_hidePanel:function(){a(".md_panel, .md_mask").remove()},_changeMonth:function(e,t){this.saveCheckedDate();var i=a(".md_selectarea").find(".monthtag"),n=~~i.data("month")+e;n>11?(n=0,this.value.year++,a(".yeartag").text(this.value.year).data("year",this.value.year)):n<0&&(n=11,this.value.year--,a(".yeartag").text(this.value.year).data("year",this.value.year));var l=s.getMonth(n)+"月";i.text(l).data("month",n),this.value.month=n,t?this.value.date=t:this.setCheckedDate(),this.updateDate(e)},_changeYear:function(e){this.saveCheckedDate();var t=a(".md_selectarea").find(".yeartag"),i=~~t.data("year")+e;t.text(i+"年").data("year",i),this.value.year=i,this.setCheckedDate(),this.updateDate(e)},saveCheckedDate:function(){this.value.date&&(this.lastCheckedDate={year:this.value.year,month:this.value.month,date:this.value.date})},setCheckedDate:function(){this.lastCheckedDate&&this.lastCheckedDate.year==this.value.year&&this.lastCheckedDate.month==this.value.month?this.value.date=this.lastCheckedDate.date:this.value.date=""},getDateStr:function(a,e,t){for(var n="",l=s.getWeekInMonth(a,e),d=s.getDaysInMonth(a,e-1),r=l-1;r>=0;r--)n+='<li class="prevdate" data-day="'+(d-r)+'">'+(d-r)+"</li>";var h=s.getDaysInMonth(a,e),u=1,v=h,o=(new Date(a,e,t),new Date(a,e,1));if(lastDate=new Date(a,e,h),minDateDay=i.minDate.getDate(),i.minDate>lastDate?u=h+1:i.minDate>=o&&i.minDate<=lastDate&&(u=minDateDay),i.maxDate){var c=i.maxDate.getDate();i.maxDate<o?v=u-1:i.maxDate>=o&&i.maxDate<=lastDate&&(v=c)}for(_=1;_<u;_++)n+='<li class="disabled" data-day="'+_+'">'+_+"</li>";for(r=u;r<=v;r++){var m="";a==this.value.year&&e==this.value.month&&t==r&&(m="current"),n+='<li class="'+m+'" data-day="'+r+'">'+r+"</li>"}for(var g=v+1;g<=h;g++)n+='<li class="disabled" data-day="'+g+'">'+g+"</li>";var f=(h+l)%7;if(0!==f)for(var _=1;_<=7-f;_++)n+='<li class="nextdate" data-day="'+_+'">'+_+"</li>";return n},updateDate:function(e){var t=a(".md_datearea.in");if(1==e)var i="out_left",n="out_right";else var i="out_right",n="out_left";var s=a('<ul class="md_datearea '+n+'"></ul>');s.html(this.getDateStr(this.value.year,this.value.month,this.value.date)),a(".md_body").append(s),setTimeout(function(){s.removeClass(n).addClass("in"),t.removeClass("in").addClass(i)},0)},refreshView:function(){if(this.input.hasClass("input-group"))e=this.input.children("input").val();else var e=this.input.val();var t=null;if(e){var i=e.split("-");t=new Date(i[0],i[1]-1,i[2])}else t=new Date;var n=this.value.year=t.getFullYear(),l=this.value.month=t.getMonth(),d=this.value.date=t.getDate();a(".yeartag").text(n).data("year",n),a(".monthtag").text(s.getMonth(l)+"月").data("month",l);var r=this.getDateStr(n,l,d);a(".md_datearea").html(r)},input:null,initListeners:function(){var e=this;n.on("click",function(){if(e.input=a(this),a(".md_mask").length)e._hidePanel();else{e.renderHTML();var t=a(".md_panel"),i=a(".md_mask");e.afterShowPanel(i,t),setTimeout(function(){e._showPanel()},50)}})},saveValueToInput:function(){var a=this,e=1+~~a.value.month;e<10&&(e="0"+e);var t=a.value.date;""===t&&(t=a.value.date=1),t<10&&(t="0"+t),a.input.hasClass("input-group")?(a.input.children("input").val(a.value.year+"-"+e+"-"+t),a.input.children("input").trigger("input")):(a.input.val(a.value.year+"-"+e+"-"+t),a.input.trigger("input")),a._hidePanel()},afterShowPanel:function(e,t){var i=this;e.on("click",function(){i._hidePanel()}),t.delegates({".change_month":function(){var e=a(this).hasClass("md_next")?1:-1;i._changeMonth(e)},".change_year":function(){var e=a(this).hasClass("md_next")?1:-1;i._changeYear(e)},".out_left, .out_right":{webkitTransitionEnd:function(){a(this).remove()}},".md_datearea li":function(){var e=a(this);if(!e.hasClass("disabled")){i.value.date=e.data("day");var t=0;e.hasClass("nextdate")?t=1:e.hasClass("prevdate")&&(t=-1),0!==t?i._changeMonth(t,i.value.date):(e.addClass("current").siblings(".current").removeClass("current"),i.saveValueToInput())}},".md_cancel":function(){i._hidePanel()},".md_ok":function(){i.saveValueToInput()}})}}.init()}}(window.Zepto||window.jQuery);